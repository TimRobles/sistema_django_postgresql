{% load funciones_propias %}
{% load humanize %}

<div class="row">
    <div class="table-responsive mb-3">
        <table class="table">
            <tbody>
                <tr>
                    <th class="pe-2">RUC: </th>
                    <td>{{ contexto_cliente_crm.numero_documento }}</td>
                    <th class="px-2">Medio: </th>
                    <td>{{ contexto_cliente_crm.get_medio_display }}</td>
                    <th class="px-2">Fecha Registro: </th>
                    <td>{{ contexto_cliente_crm.created_at|date:'d/m/Y' }}</td>
                </tr>
                <tr>
                    <th class="pe-2">Última Factura: </th>
                    <td>{{ contexto_cliente_crm.nro_factura.serie_comprobante.serie }}-{{contexto_cliente_crm.nro_factura.numero_factura|numeroXn:6 }}</td>
                    <th class="px-2">Monto Total: </th>
                    <td>{{ contexto_cliente_crm.nro_factura.moneda.simbolo }} {{ contexto_cliente_crm.nro_factura.total|redondear|intcomma }}</td>
                    <th class="px-2">Estado: </th>
                    <td>{{ contexto_cliente_crm.get_estado_cliente_display }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<br>
<h3>Información de Actividad
    <button data-form-url="{% url 'crm_app:cliente_crm_detalle_registrar' contexto_cliente_crm.id %}"
        data-table-url="{% url 'crm_app:cliente_crm_detalle_tabla' contexto_cliente_crm.id %}"
        class="create badge bg-success">
        Registrar
    </button>
    <a href="{% url 'crm_app:cliente_crm_inicio' %}"><span class="badge bg-primary">Regresar</span></a>
</h3>

<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Actividad</th>
                <th>Interlocutor</th>
                <th>Dirección</th>
                <th>Fecha</th>
                <th>Hora Inicio</th>
                <th>Hora Fin</th>
                <th>Usuario Registro</th>
                <th>Archivo Recibido</th>
                <th>Archivo Enviado</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente_crm in cliente_crm_detalle %}
            <tr>
                <td>{{ cliente_crm.get_tipo_actividad_display }}</td>
                <td>{{ cliente_crm.interlocutor }}</td>
                <td>
                    {% if cliente_crm.direccion %}
                        {{ cliente_crm.direccion}}
                    {% endif %}
                </td>
                <td>{{ cliente_crm.fecha|date:'d/m/Y' }}</td>
                <td>
                    {% if cliente_crm.hora_inicio %}
                        {{ cliente_crm.hora_inicio }}
                    {% endif %}
                </td>
                <td>
                    {% if cliente_crm.hora_fin %}
                        {{ cliente_crm.hora_fin }}
                    {% endif %}
                </td>
                <td>{{ cliente_crm.created_by}}</td>
                <td class="text-center">
                    {% if cliente_crm.archivo_recibido %}
                        <a href="{{ MEDIA_URL }}{{ cliente_crm.archivo_recibido}}" target="_blank">Ver Archivo</a>
                    {% endif %} 
                </td>
                <td class="text-center">
                    {% if cliente_crm.archivo_enviado %}
                        <a href="{{ MEDIA_URL }}{{ cliente_crm.archivo_enviado}}" target="_blank">Ver Archivo</a>
                    {% endif %}
                </td>
                <td class="text-center text-nowrap">
                    <button data-form-url="{% url 'crm_app:cliente_crm_detalle_actualizar' cliente_crm.id %}"
                        data-table-url="{% url 'crm_app:cliente_crm_detalle_tabla' contexto_cliente_crm.id %}"
                        data-keep-open="true"
                        class="update btn btn-warning btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Actualizar">
                        <i class="bi bi-pencil-fill"></i>
                    </button>
                    <button data-form-url="{% url 'crm_app:cliente_crm_detalle_eliminar' cliente_crm.id  %}"
                        class="delete btn btn-danger btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar">
                        <i class="bi-x-lg"></i>
                    </button>
                    <button data-form-url="{% url 'crm_app:cliente_crm_detalle_ver' cliente_crm.id  %}"
                        data-table-url="{% url 'crm_app:cliente_crm_detalle_tabla' contexto_cliente_crm.id %}"
                        class="update btn btn-info btn-sm"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Ver"
                        data-modal = 'modal-xl'>
                        <i class="bi bi-eye-fill"></i>
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>